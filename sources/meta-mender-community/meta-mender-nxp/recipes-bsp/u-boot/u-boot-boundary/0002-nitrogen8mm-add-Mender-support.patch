From 6042f5a1ec3cc1d912a264c1306159867de72aa3 Mon Sep 17 00:00:00 2001
From: Chris Dimich <chris.dimich@boundarydevices.com>
Date: Tue, 1 Nov 2022 10:54:30 -0700
Subject: [PATCH 2/4] nitrogen8mm*: add Mender support

Signed-off-by: Chris Dimich <chris.dimich@boundarydevices.com>
---
 configs/nitrogen8mm_2g_defconfig        | 6 +++++-
 configs/nitrogen8mm_2gr0_defconfig      | 6 +++++-
 configs/nitrogen8mm_4g_defconfig        | 6 +++++-
 configs/nitrogen8mm_rev2_2g_defconfig   | 6 +++++-
 configs/nitrogen8mm_rev2_2gr0_defconfig | 6 +++++-
 configs/nitrogen8mm_rev2_4g_defconfig   | 6 +++++-
 configs/nitrogen8mm_som_1gr0_defconfig  | 6 +++++-
 configs/nitrogen8mm_som_2g_defconfig    | 6 +++++-
 configs/nitrogen8mm_som_2gr0_defconfig  | 6 +++++-
 configs/nitrogen8mm_som_4g_defconfig    | 6 +++++-
 10 files changed, 50 insertions(+), 10 deletions(-)

diff --git a/configs/nitrogen8mm_2g_defconfig b/configs/nitrogen8mm_2g_defconfig
index cc7ff277e7..264a997c4a 100644
--- a/configs/nitrogen8mm_2g_defconfig
+++ b/configs/nitrogen8mm_2g_defconfig
@@ -12,7 +12,7 @@ CONFIG_NR_DRAM_BANKS=2
 CONFIG_SYS_MEMTEST_START=0x40000000
 CONFIG_SYS_MEMTEST_END=0x40010000
 CONFIG_ENV_SIZE=0x2000
-CONFIG_ENV_OFFSET=0xffffe000
+CONFIG_ENV_OFFSET=0x3fe000
 CONFIG_IMX_CONFIG="arch/arm/mach-imx/imx8m/imximage.cfg"
 # CONFIG_SPLASH_SCREEN_PREPARE is not set
 CONFIG_DDR_MB=2048
@@ -91,6 +91,8 @@ CONFIG_SYS_RELOC_GD_ENV_ADDR=y
 CONFIG_SYS_MMC_ENV_PART=1
 CONFIG_ENV_VARS_UBOOT_RUNTIME_CONFIG=y
 CONFIG_NET_RANDOM_ETHADDR=y
+CONFIG_BOOTCOUNT_LIMIT=y
+CONFIG_BOOTCOUNT_ENV=y
 CONFIG_NETCONSOLE=y
 CONFIG_SPL_DM=y
 CONFIG_REGMAP=y
@@ -174,3 +176,5 @@ CONFIG_SPLASH_SCREEN_ALIGN=y
 CONFIG_VIDEO_BMP_GZIP=y
 CONFIG_IMX_WATCHDOG=y
 CONFIG_LIBAVB=y
+CONFIG_SYS_REDUNDAND_ENVIRONMENT=y
+CONFIG_ENV_OFFSET_REDUND=0x3fc000
diff --git a/configs/nitrogen8mm_2gr0_defconfig b/configs/nitrogen8mm_2gr0_defconfig
index 68b5853d59..1bea415154 100644
--- a/configs/nitrogen8mm_2gr0_defconfig
+++ b/configs/nitrogen8mm_2gr0_defconfig
@@ -12,7 +12,7 @@ CONFIG_NR_DRAM_BANKS=2
 CONFIG_SYS_MEMTEST_START=0x40000000
 CONFIG_SYS_MEMTEST_END=0x40010000
 CONFIG_ENV_SIZE=0x2000
-CONFIG_ENV_OFFSET=0xffffe000
+CONFIG_ENV_OFFSET=0x3fe000
 CONFIG_IMX_CONFIG="arch/arm/mach-imx/imx8m/imximage.cfg"
 # CONFIG_SPLASH_SCREEN_PREPARE is not set
 CONFIG_DDR_RANK_BITS=0
@@ -92,6 +92,8 @@ CONFIG_SYS_RELOC_GD_ENV_ADDR=y
 CONFIG_SYS_MMC_ENV_PART=1
 CONFIG_ENV_VARS_UBOOT_RUNTIME_CONFIG=y
 CONFIG_NET_RANDOM_ETHADDR=y
+CONFIG_BOOTCOUNT_LIMIT=y
+CONFIG_BOOTCOUNT_ENV=y
 CONFIG_NETCONSOLE=y
 CONFIG_SPL_DM=y
 CONFIG_REGMAP=y
@@ -175,3 +177,5 @@ CONFIG_SPLASH_SCREEN_ALIGN=y
 CONFIG_VIDEO_BMP_GZIP=y
 CONFIG_IMX_WATCHDOG=y
 CONFIG_LIBAVB=y
+CONFIG_SYS_REDUNDAND_ENVIRONMENT=y
+CONFIG_ENV_OFFSET_REDUND=0x3fc000
diff --git a/configs/nitrogen8mm_4g_defconfig b/configs/nitrogen8mm_4g_defconfig
index 1b080805b7..969bed9141 100644
--- a/configs/nitrogen8mm_4g_defconfig
+++ b/configs/nitrogen8mm_4g_defconfig
@@ -12,7 +12,7 @@ CONFIG_NR_DRAM_BANKS=2
 CONFIG_SYS_MEMTEST_START=0x40000000
 CONFIG_SYS_MEMTEST_END=0x40010000
 CONFIG_ENV_SIZE=0x2000
-CONFIG_ENV_OFFSET=0xffffe000
+CONFIG_ENV_OFFSET=0x3fe000
 CONFIG_IMX_CONFIG="arch/arm/mach-imx/imx8m/imximage.cfg"
 # CONFIG_SPLASH_SCREEN_PREPARE is not set
 CONFIG_DDR_MB=4096
@@ -91,6 +91,8 @@ CONFIG_SYS_RELOC_GD_ENV_ADDR=y
 CONFIG_SYS_MMC_ENV_PART=1
 CONFIG_ENV_VARS_UBOOT_RUNTIME_CONFIG=y
 CONFIG_NET_RANDOM_ETHADDR=y
+CONFIG_BOOTCOUNT_LIMIT=y
+CONFIG_BOOTCOUNT_ENV=y
 CONFIG_NETCONSOLE=y
 CONFIG_SPL_DM=y
 CONFIG_REGMAP=y
@@ -174,3 +176,5 @@ CONFIG_SPLASH_SCREEN_ALIGN=y
 CONFIG_VIDEO_BMP_GZIP=y
 CONFIG_IMX_WATCHDOG=y
 CONFIG_LIBAVB=y
+CONFIG_SYS_REDUNDAND_ENVIRONMENT=y
+CONFIG_ENV_OFFSET_REDUND=0x3fc000
diff --git a/configs/nitrogen8mm_rev2_2g_defconfig b/configs/nitrogen8mm_rev2_2g_defconfig
index b0a222fb0a..88725045d6 100644
--- a/configs/nitrogen8mm_rev2_2g_defconfig
+++ b/configs/nitrogen8mm_rev2_2g_defconfig
@@ -12,7 +12,7 @@ CONFIG_NR_DRAM_BANKS=2
 CONFIG_SYS_MEMTEST_START=0x40000000
 CONFIG_SYS_MEMTEST_END=0x40010000
 CONFIG_ENV_SIZE=0x2000
-CONFIG_ENV_OFFSET=0xffffe000
+CONFIG_ENV_OFFSET=0x3fe000
 CONFIG_IMX_CONFIG="arch/arm/mach-imx/imx8m/imximage.cfg"
 # CONFIG_SPLASH_SCREEN_PREPARE is not set
 CONFIG_DDR_MB=2048
@@ -92,6 +92,8 @@ CONFIG_SYS_RELOC_GD_ENV_ADDR=y
 CONFIG_SYS_MMC_ENV_PART=1
 CONFIG_ENV_VARS_UBOOT_RUNTIME_CONFIG=y
 CONFIG_NET_RANDOM_ETHADDR=y
+CONFIG_BOOTCOUNT_LIMIT=y
+CONFIG_BOOTCOUNT_ENV=y
 CONFIG_NETCONSOLE=y
 CONFIG_SPL_DM=y
 CONFIG_REGMAP=y
@@ -176,3 +178,5 @@ CONFIG_SPLASH_SCREEN_ALIGN=y
 CONFIG_VIDEO_BMP_GZIP=y
 CONFIG_IMX_WATCHDOG=y
 CONFIG_LIBAVB=y
+CONFIG_SYS_REDUNDAND_ENVIRONMENT=y
+CONFIG_ENV_OFFSET_REDUND=0x3fc000
diff --git a/configs/nitrogen8mm_rev2_2gr0_defconfig b/configs/nitrogen8mm_rev2_2gr0_defconfig
index 3336970b9a..3c567dd20a 100644
--- a/configs/nitrogen8mm_rev2_2gr0_defconfig
+++ b/configs/nitrogen8mm_rev2_2gr0_defconfig
@@ -12,7 +12,7 @@ CONFIG_NR_DRAM_BANKS=2
 CONFIG_SYS_MEMTEST_START=0x40000000
 CONFIG_SYS_MEMTEST_END=0x40010000
 CONFIG_ENV_SIZE=0x2000
-CONFIG_ENV_OFFSET=0xffffe000
+CONFIG_ENV_OFFSET=0x3fe000
 CONFIG_IMX_CONFIG="arch/arm/mach-imx/imx8m/imximage.cfg"
 # CONFIG_SPLASH_SCREEN_PREPARE is not set
 CONFIG_DDR_RANK_BITS=0
@@ -93,6 +93,8 @@ CONFIG_SYS_RELOC_GD_ENV_ADDR=y
 CONFIG_SYS_MMC_ENV_PART=1
 CONFIG_ENV_VARS_UBOOT_RUNTIME_CONFIG=y
 CONFIG_NET_RANDOM_ETHADDR=y
+CONFIG_BOOTCOUNT_LIMIT=y
+CONFIG_BOOTCOUNT_ENV=y
 CONFIG_NETCONSOLE=y
 CONFIG_SPL_DM=y
 CONFIG_REGMAP=y
@@ -177,3 +179,5 @@ CONFIG_SPLASH_SCREEN_ALIGN=y
 CONFIG_VIDEO_BMP_GZIP=y
 CONFIG_IMX_WATCHDOG=y
 CONFIG_LIBAVB=y
+CONFIG_SYS_REDUNDAND_ENVIRONMENT=y
+CONFIG_ENV_OFFSET_REDUND=0x3fc000
diff --git a/configs/nitrogen8mm_rev2_4g_defconfig b/configs/nitrogen8mm_rev2_4g_defconfig
index be16034310..a4c0d9d87e 100644
--- a/configs/nitrogen8mm_rev2_4g_defconfig
+++ b/configs/nitrogen8mm_rev2_4g_defconfig
@@ -12,7 +12,7 @@ CONFIG_NR_DRAM_BANKS=2
 CONFIG_SYS_MEMTEST_START=0x40000000
 CONFIG_SYS_MEMTEST_END=0x40010000
 CONFIG_ENV_SIZE=0x2000
-CONFIG_ENV_OFFSET=0xffffe000
+CONFIG_ENV_OFFSET=0x3fe000
 CONFIG_IMX_CONFIG="arch/arm/mach-imx/imx8m/imximage.cfg"
 # CONFIG_SPLASH_SCREEN_PREPARE is not set
 CONFIG_DDR_MB=4096
@@ -92,6 +92,8 @@ CONFIG_SYS_RELOC_GD_ENV_ADDR=y
 CONFIG_SYS_MMC_ENV_PART=1
 CONFIG_ENV_VARS_UBOOT_RUNTIME_CONFIG=y
 CONFIG_NET_RANDOM_ETHADDR=y
+CONFIG_BOOTCOUNT_LIMIT=y
+CONFIG_BOOTCOUNT_ENV=y
 CONFIG_NETCONSOLE=y
 CONFIG_SPL_DM=y
 CONFIG_REGMAP=y
@@ -176,3 +178,5 @@ CONFIG_SPLASH_SCREEN_ALIGN=y
 CONFIG_VIDEO_BMP_GZIP=y
 CONFIG_IMX_WATCHDOG=y
 CONFIG_LIBAVB=y
+CONFIG_SYS_REDUNDAND_ENVIRONMENT=y
+CONFIG_ENV_OFFSET_REDUND=0x3fc000
diff --git a/configs/nitrogen8mm_som_1gr0_defconfig b/configs/nitrogen8mm_som_1gr0_defconfig
index 585f3cfe69..d3f26797af 100644
--- a/configs/nitrogen8mm_som_1gr0_defconfig
+++ b/configs/nitrogen8mm_som_1gr0_defconfig
@@ -12,7 +12,7 @@ CONFIG_NR_DRAM_BANKS=2
 CONFIG_SYS_MEMTEST_START=0x40000000
 CONFIG_SYS_MEMTEST_END=0x40010000
 CONFIG_ENV_SIZE=0x2000
-CONFIG_ENV_OFFSET=0xffffe000
+CONFIG_ENV_OFFSET=0x3fe000
 CONFIG_IMX_CONFIG="arch/arm/mach-imx/imx8m/imximage.cfg"
 # CONFIG_SPLASH_SCREEN_PREPARE is not set
 CONFIG_DDR_RANK_BITS=0
@@ -93,6 +93,8 @@ CONFIG_SYS_RELOC_GD_ENV_ADDR=y
 CONFIG_SYS_MMC_ENV_PART=1
 CONFIG_ENV_VARS_UBOOT_RUNTIME_CONFIG=y
 CONFIG_NET_RANDOM_ETHADDR=y
+CONFIG_BOOTCOUNT_LIMIT=y
+CONFIG_BOOTCOUNT_ENV=y
 CONFIG_NETCONSOLE=y
 CONFIG_SPL_DM=y
 CONFIG_REGMAP=y
@@ -177,3 +179,5 @@ CONFIG_SPLASH_SCREEN_ALIGN=y
 CONFIG_VIDEO_BMP_GZIP=y
 CONFIG_IMX_WATCHDOG=y
 CONFIG_LIBAVB=y
+CONFIG_SYS_REDUNDAND_ENVIRONMENT=y
+CONFIG_ENV_OFFSET_REDUND=0x3fc000
diff --git a/configs/nitrogen8mm_som_2g_defconfig b/configs/nitrogen8mm_som_2g_defconfig
index 4b45653bf2..dd4de70205 100644
--- a/configs/nitrogen8mm_som_2g_defconfig
+++ b/configs/nitrogen8mm_som_2g_defconfig
@@ -12,7 +12,7 @@ CONFIG_NR_DRAM_BANKS=2
 CONFIG_SYS_MEMTEST_START=0x40000000
 CONFIG_SYS_MEMTEST_END=0x40010000
 CONFIG_ENV_SIZE=0x2000
-CONFIG_ENV_OFFSET=0xffffe000
+CONFIG_ENV_OFFSET=0x3fe000
 CONFIG_IMX_CONFIG="arch/arm/mach-imx/imx8m/imximage.cfg"
 # CONFIG_SPLASH_SCREEN_PREPARE is not set
 CONFIG_DDR_MB=2048
@@ -92,6 +92,8 @@ CONFIG_SYS_RELOC_GD_ENV_ADDR=y
 CONFIG_SYS_MMC_ENV_PART=1
 CONFIG_ENV_VARS_UBOOT_RUNTIME_CONFIG=y
 CONFIG_NET_RANDOM_ETHADDR=y
+CONFIG_BOOTCOUNT_LIMIT=y
+CONFIG_BOOTCOUNT_ENV=y
 CONFIG_NETCONSOLE=y
 CONFIG_SPL_DM=y
 CONFIG_REGMAP=y
@@ -176,3 +178,5 @@ CONFIG_SPLASH_SCREEN_ALIGN=y
 CONFIG_VIDEO_BMP_GZIP=y
 CONFIG_IMX_WATCHDOG=y
 CONFIG_LIBAVB=y
+CONFIG_SYS_REDUNDAND_ENVIRONMENT=y
+CONFIG_ENV_OFFSET_REDUND=0x3fc000
diff --git a/configs/nitrogen8mm_som_2gr0_defconfig b/configs/nitrogen8mm_som_2gr0_defconfig
index 71ffe95f4c..10bec8b206 100644
--- a/configs/nitrogen8mm_som_2gr0_defconfig
+++ b/configs/nitrogen8mm_som_2gr0_defconfig
@@ -12,7 +12,7 @@ CONFIG_NR_DRAM_BANKS=2
 CONFIG_SYS_MEMTEST_START=0x40000000
 CONFIG_SYS_MEMTEST_END=0x40010000
 CONFIG_ENV_SIZE=0x2000
-CONFIG_ENV_OFFSET=0xffffe000
+CONFIG_ENV_OFFSET=0x3fe000
 CONFIG_IMX_CONFIG="arch/arm/mach-imx/imx8m/imximage.cfg"
 # CONFIG_SPLASH_SCREEN_PREPARE is not set
 CONFIG_DDR_RANK_BITS=0
@@ -93,6 +93,8 @@ CONFIG_SYS_RELOC_GD_ENV_ADDR=y
 CONFIG_SYS_MMC_ENV_PART=1
 CONFIG_ENV_VARS_UBOOT_RUNTIME_CONFIG=y
 CONFIG_NET_RANDOM_ETHADDR=y
+CONFIG_BOOTCOUNT_LIMIT=y
+CONFIG_BOOTCOUNT_ENV=y
 CONFIG_NETCONSOLE=y
 CONFIG_SPL_DM=y
 CONFIG_REGMAP=y
@@ -177,3 +179,5 @@ CONFIG_SPLASH_SCREEN_ALIGN=y
 CONFIG_VIDEO_BMP_GZIP=y
 CONFIG_IMX_WATCHDOG=y
 CONFIG_LIBAVB=y
+CONFIG_SYS_REDUNDAND_ENVIRONMENT=y
+CONFIG_ENV_OFFSET_REDUND=0x3fc000
diff --git a/configs/nitrogen8mm_som_4g_defconfig b/configs/nitrogen8mm_som_4g_defconfig
index 306f90836c..29367643f2 100644
--- a/configs/nitrogen8mm_som_4g_defconfig
+++ b/configs/nitrogen8mm_som_4g_defconfig
@@ -12,7 +12,7 @@ CONFIG_NR_DRAM_BANKS=2
 CONFIG_SYS_MEMTEST_START=0x40000000
 CONFIG_SYS_MEMTEST_END=0x40010000
 CONFIG_ENV_SIZE=0x2000
-CONFIG_ENV_OFFSET=0xffffe000
+CONFIG_ENV_OFFSET=0x3fe000
 CONFIG_IMX_CONFIG="arch/arm/mach-imx/imx8m/imximage.cfg"
 # CONFIG_SPLASH_SCREEN_PREPARE is not set
 CONFIG_DDR_MB=4096
@@ -92,6 +92,8 @@ CONFIG_SYS_RELOC_GD_ENV_ADDR=y
 CONFIG_SYS_MMC_ENV_PART=1
 CONFIG_ENV_VARS_UBOOT_RUNTIME_CONFIG=y
 CONFIG_NET_RANDOM_ETHADDR=y
+CONFIG_BOOTCOUNT_LIMIT=y
+CONFIG_BOOTCOUNT_ENV=y
 CONFIG_NETCONSOLE=y
 CONFIG_SPL_DM=y
 CONFIG_REGMAP=y
@@ -176,3 +178,5 @@ CONFIG_SPLASH_SCREEN_ALIGN=y
 CONFIG_VIDEO_BMP_GZIP=y
 CONFIG_IMX_WATCHDOG=y
 CONFIG_LIBAVB=y
+CONFIG_SYS_REDUNDAND_ENVIRONMENT=y
+CONFIG_ENV_OFFSET_REDUND=0x3fc000
-- 
2.34.1

