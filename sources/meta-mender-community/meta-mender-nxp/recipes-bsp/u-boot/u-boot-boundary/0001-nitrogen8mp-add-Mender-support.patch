From 0be363894c27f3a2050990751c996dcb00273ee1 Mon Sep 17 00:00:00 2001
From: Chris Dimich <chris.dimich@boundarydevices.com>
Date: Tue, 1 Nov 2022 10:53:26 -0700
Subject: [PATCH 1/4] nitrogen8mp*: add Mender support

Signed-off-by: Chris Dimich <chris.dimich@boundarydevices.com>
---
 configs/nitrogen8mp_2g_defconfig   | 6 +++++-
 configs/nitrogen8mp_2gr0_defconfig | 6 +++++-
 configs/nitrogen8mp_4g_defconfig   | 6 +++++-
 configs/nitrogen8mp_8g_defconfig   | 6 +++++-
 4 files changed, 20 insertions(+), 4 deletions(-)

diff --git a/configs/nitrogen8mp_2g_defconfig b/configs/nitrogen8mp_2g_defconfig
index 16cd635785..12399f88b4 100644
--- a/configs/nitrogen8mp_2g_defconfig
+++ b/configs/nitrogen8mp_2g_defconfig
@@ -10,7 +10,7 @@ CONFIG_SPL_LIBCOMMON_SUPPORT=y
 CONFIG_SPL_LIBGENERIC_SUPPORT=y
 CONFIG_NR_DRAM_BANKS=3
 CONFIG_ENV_SIZE=0x2000
-CONFIG_ENV_OFFSET=0xffffe000
+CONFIG_ENV_OFFSET=0x3fe000
 CONFIG_IMX_CONFIG="arch/arm/mach-imx/imx8m/imximage-8mp-lpddr4.cfg"
 # CONFIG_SPLASH_SCREEN_PREPARE is not set
 CONFIG_DDR_MB=2048
@@ -87,6 +87,8 @@ CONFIG_SYS_MMC_ENV_DEV=2
 CONFIG_SYS_MMC_ENV_PART=1
 CONFIG_ENV_VARS_UBOOT_RUNTIME_CONFIG=y
 CONFIG_NET_RANDOM_ETHADDR=y
+CONFIG_BOOTCOUNT_LIMIT=y
+CONFIG_BOOTCOUNT_ENV=y
 CONFIG_SPL_DM=y
 CONFIG_REGMAP=y
 CONFIG_SYSCON=y
@@ -193,3 +195,5 @@ CONFIG_VIDEO_BMP_GZIP=y
 CONFIG_IMX_WATCHDOG=y
 CONFIG_LIBAVB=y
 CONFIG_OF_LIBFDT_OVERLAY=y
+CONFIG_SYS_REDUNDAND_ENVIRONMENT=y
+CONFIG_ENV_OFFSET_REDUND=0x3fc000
diff --git a/configs/nitrogen8mp_2gr0_defconfig b/configs/nitrogen8mp_2gr0_defconfig
index d3e5dc57a7..c7446957ee 100644
--- a/configs/nitrogen8mp_2gr0_defconfig
+++ b/configs/nitrogen8mp_2gr0_defconfig
@@ -10,7 +10,7 @@ CONFIG_SPL_LIBCOMMON_SUPPORT=y
 CONFIG_SPL_LIBGENERIC_SUPPORT=y
 CONFIG_NR_DRAM_BANKS=3
 CONFIG_ENV_SIZE=0x2000
-CONFIG_ENV_OFFSET=0xffffe000
+CONFIG_ENV_OFFSET=0x3fe000
 CONFIG_IMX_CONFIG="arch/arm/mach-imx/imx8m/imximage-8mp-lpddr4.cfg"
 # CONFIG_SPLASH_SCREEN_PREPARE is not set
 CONFIG_DDR_RANK_BITS=0
@@ -87,6 +87,8 @@ CONFIG_SYS_RELOC_GD_ENV_ADDR=y
 CONFIG_SYS_MMC_ENV_DEV=2
 CONFIG_SYS_MMC_ENV_PART=1
 CONFIG_ENV_VARS_UBOOT_RUNTIME_CONFIG=y
+CONFIG_BOOTCOUNT_LIMIT=y
+CONFIG_BOOTCOUNT_ENV=y
 CONFIG_NET_RANDOM_ETHADDR=y
 CONFIG_SPL_DM=y
 CONFIG_REGMAP=y
@@ -194,3 +196,5 @@ CONFIG_VIDEO_BMP_GZIP=y
 CONFIG_IMX_WATCHDOG=y
 CONFIG_LIBAVB=y
 CONFIG_OF_LIBFDT_OVERLAY=y
+CONFIG_SYS_REDUNDAND_ENVIRONMENT=y
+CONFIG_ENV_OFFSET_REDUND=0x3fc000
diff --git a/configs/nitrogen8mp_4g_defconfig b/configs/nitrogen8mp_4g_defconfig
index e58aedb0d7..9c9ee5714d 100644
--- a/configs/nitrogen8mp_4g_defconfig
+++ b/configs/nitrogen8mp_4g_defconfig
@@ -10,7 +10,7 @@ CONFIG_SPL_LIBCOMMON_SUPPORT=y
 CONFIG_SPL_LIBGENERIC_SUPPORT=y
 CONFIG_NR_DRAM_BANKS=3
 CONFIG_ENV_SIZE=0x2000
-CONFIG_ENV_OFFSET=0xffffe000
+CONFIG_ENV_OFFSET=0x3fe000
 CONFIG_IMX_CONFIG="arch/arm/mach-imx/imx8m/imximage-8mp-lpddr4.cfg"
 # CONFIG_SPLASH_SCREEN_PREPARE is not set
 CONFIG_DDR_MB=4096
@@ -87,6 +87,8 @@ CONFIG_SYS_MMC_ENV_DEV=2
 CONFIG_SYS_MMC_ENV_PART=1
 CONFIG_ENV_VARS_UBOOT_RUNTIME_CONFIG=y
 CONFIG_NET_RANDOM_ETHADDR=y
+CONFIG_BOOTCOUNT_LIMIT=y
+CONFIG_BOOTCOUNT_ENV=y
 CONFIG_SPL_DM=y
 CONFIG_REGMAP=y
 CONFIG_SYSCON=y
@@ -193,3 +195,5 @@ CONFIG_VIDEO_BMP_GZIP=y
 CONFIG_IMX_WATCHDOG=y
 CONFIG_LIBAVB=y
 CONFIG_OF_LIBFDT_OVERLAY=y
+CONFIG_SYS_REDUNDAND_ENVIRONMENT=y
+CONFIG_ENV_OFFSET_REDUND=0x3fc000
diff --git a/configs/nitrogen8mp_8g_defconfig b/configs/nitrogen8mp_8g_defconfig
index 825a26bba1..117fa219d6 100644
--- a/configs/nitrogen8mp_8g_defconfig
+++ b/configs/nitrogen8mp_8g_defconfig
@@ -10,7 +10,7 @@ CONFIG_SPL_LIBCOMMON_SUPPORT=y
 CONFIG_SPL_LIBGENERIC_SUPPORT=y
 CONFIG_NR_DRAM_BANKS=3
 CONFIG_ENV_SIZE=0x2000
-CONFIG_ENV_OFFSET=0xffffe000
+CONFIG_ENV_OFFSET=0x3fe000
 CONFIG_IMX_CONFIG="arch/arm/mach-imx/imx8m/imximage-8mp-lpddr4.cfg"
 # CONFIG_SPLASH_SCREEN_PREPARE is not set
 CONFIG_DDR_MB=8192
@@ -87,6 +87,8 @@ CONFIG_SYS_MMC_ENV_DEV=2
 CONFIG_SYS_MMC_ENV_PART=1
 CONFIG_ENV_VARS_UBOOT_RUNTIME_CONFIG=y
 CONFIG_NET_RANDOM_ETHADDR=y
+CONFIG_BOOTCOUNT_LIMIT=y
+CONFIG_BOOTCOUNT_ENV=y
 CONFIG_SPL_DM=y
 CONFIG_REGMAP=y
 CONFIG_SYSCON=y
@@ -193,3 +195,5 @@ CONFIG_VIDEO_BMP_GZIP=y
 CONFIG_IMX_WATCHDOG=y
 CONFIG_LIBAVB=y
 CONFIG_OF_LIBFDT_OVERLAY=y
+CONFIG_SYS_REDUNDAND_ENVIRONMENT=y
+CONFIG_ENV_OFFSET_REDUND=0x3fc000
-- 
2.34.1

